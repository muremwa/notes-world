(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(e,t,n){e.exports=n(24)},18:function(e,t,n){},20:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);var a=n(12),r=n(0),o=n.n(r),i=n(9),c=n.n(i),s=(n(18),n(1)),m=n(2),l=n(4),u=n(3),d=n(5),h=(n(20),n(6)),p=new(n(10).Dispatcher),f=n(7),y=n.n(f);var E=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"submitComment",value:function(e){e.preventDefault(),window.f=e.target.children;var t,n=e.target.children[0].children[1].value;e.target.children[2].style.display="",t=n,y.a.ajax({type:"POST",url:H,crossDomain:!0,data:{comment:t,csrfmiddlewaretoken:S},success:function(e){p.dispatch({type:"COMMENT_CREATED",payload:e.comment}),document.getElementById("comment-alert-info").style.display="none",document.getElementById("comment-alert-error").style.display="none",document.getElementById("id_comment").value=""},error:function(e){document.getElementById("comment-alert-info").style.display="none",document.getElementById("comment-alert-error").style.display=""}})}},{key:"render",value:function(){var e={display:"none"};return o.a.createElement("form",{method:"post",encType:"multipart/form-data",onSubmit:this.submitComment.bind(this)},o.a.createElement("div",{className:"form-group",name:"comment-textarea-group"},o.a.createElement("label",null,"Comment:"),o.a.createElement("textarea",{name:"comment-textarea",className:"form-control",cols:"40",rows:"10",maxLength:"140",required:!0,id:"id_comment",placeholder:"add comment here (use '@username' to mention someone)"})),o.a.createElement("hr",null),o.a.createElement("div",{className:"alert alert-info",id:"comment-alert-info",name:"comment-info",style:e},o.a.createElement("button",{type:"button",className:"close","data-dismiss":"alert","aria-hidden":"true"},"\xd7"),"Posting your comment..."),o.a.createElement("div",{className:"alert alert-warning",id:"comment-alert-error",style:e},"Could not post your comment. Refresh the page and try again"),o.a.createElement("button",{type:"submit",className:"col-sm-4 form-control"},"Comment"))}}]),t}(r.Component);function g(e,t){var n="<a href='".concat(L,"?username=").concat(t.split("@")[1],"'>").concat(t,"</a>");return e.split(t).join(n)}function b(e){return o.a.createElement("div",{className:"col-sm-1 user-img"},o.a.createElement("img",{src:e.profile,alt:"profile picture for "+e.user}))}function v(e){var t="delete comment"===e.action?"danger":"dark";return o.a.createElement("button",{onClick:e.clickHandler,className:"btn btn-link text-"+t,"data-id":e.id,"data-url":e.actionUrl},e.action)}var O=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"editComment",value:function(e){e.preventDefault();var t=this.props.actionUrl,n=e.target.children[0].children[0].value,a=e.target.parentElement.parentElement.children[1],r=a.innerHTML;a.innerHTML="<h2>Editing comment...</h2>",n!==this.props.comment?function(e,t,n){y.a.ajax({headers:{"X-HTTP-Method-Override":"PATCH"},type:"POST",url:t,crossDomain:!0,data:{original_comment:e,csrfmiddlewaretoken:S},success:function(e){!0===e.success?p.dispatch({type:"COMMENT_EDIT",payload:e}):n.innerHTML='<div class="alert alert-warning">                                         <strong>Error!</strong> Could not edit your comment: '.concat(e.error_message,". Refresh the page and try again...                                     </div>")},error:function(e){n.innerHTML='<div class="alert alert-warning">                                         <strong>Error!</strong> Could not edit your comment: '.concat(e.statusText,". Refresh the page and try again...                                     </div>")}})}(n,t,e.target):(e.target.style.display="none",a.innerHTML=r)}},{key:"handleAbort",value:function(e){e.target.parentElement.style.display="none"}},{key:"render",value:function(){if(!this.props.editable)return null;return o.a.createElement("form",{className:"form-inline",style:{display:"none"},name:"edit-comment-form",onSubmit:this.editComment.bind(this)},o.a.createElement("div",{className:"form-group col-sm-7",name:"edit-control"},o.a.createElement("textarea",{className:"form-control",name:"edit-comment",required:!0,defaultValue:this.props.comment})),o.a.createElement("div",{style:{width:"30%"},className:"form-group col-sm-2"},o.a.createElement("input",{type:"submit",className:"btn form-control",value:"edit"})),o.a.createElement("span",{onClick:this.handleAbort,className:"btn text-danger close-edit"},"abort"))}}]),t}(r.Component),C=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={actions:[{action:"reply",actionUrl:"/reply/",edit:!0,clickHandler:function(e){var t=e.target.attributes["data-url"].value;window.location.href=t}},{action:"edit comment",actionUrl:"/edit/",edit:!0,clickHandler:function(e){e.target.parentElement.children[e.target.parentElement.children.length-2].style.display=""}},{action:"delete comment",actionUrl:"/delete/",edit:!0,clickHandler:function(e){var t=e.target.attributes["data-url"].value,n=e.target.attributes["data-id"].value;e.target.innerText="Deleting comment",function(e,t,n){y.a.ajax({headers:{"X-HTTP-Method-Override":"DELETE"},type:"POST",url:e,crossDomain:!0,data:{csrfmiddlewaretoken:S},success:function(e){!0===e.success?p.dispatch({type:"DELETE_COMMENT",comment:t}):(n.classList.add("disabled"),n.innerText="Could not delete comment")},error:function(e){console.log("could not delete the comment",e.statusText,e.status),n.classList.add("disabled"),n.innerText="Could not delete comment"}})}(t,n,e.target)}},{action:"flag",actionUrl:"/flag/",edit:!1,clickHandler:function(e){console.log("flag coming soon")}}]},e}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.replyUrl,a=t.actionUrl,r=t.id,i=t.comment,c=this.state.actions.filter(function(t){return t.edit===e.props.editable||"reply"===t.action}).map(function(e,t){return"reply"===e.action?e.actionUrl=n:"delete comment"===e.action&&(e.actionUrl=a),o.a.createElement(v,Object.assign({key:t,id:r},e))});if(this.props.ownsNote&&2===c.length){var s=o.a.createElement(v,Object.assign({key:2,id:r},this.state.actions[2],{actionUrl:a}));c.splice(1,0,s)}return o.a.createElement("div",{className:"action-buttons"},c,o.a.createElement(O,{comment:i,actionUrl:a,editable:this.props.editable}),o.a.createElement("hr",null))}}]),t}(r.Component);function j(e){return e.edited?o.a.createElement("span",{className:"text-info"},"edited"):null}var k=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.user,a=e.time,r=e.edited,i=e.replies,c=e.comment,s=function(e){var t=e.match(/@\w+/g),n=e;if(null!==t){var a=!0,r=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(a=(i=c.next()).done);a=!0)n=g(n,i.value)}catch(s){r=!0,o=s}finally{try{a||null==c.return||c.return()}finally{if(r)throw o}}}return n}(c);return o.a.createElement("div",{className:"col-sm-11"},o.a.createElement("span",{className:"comment-info"},o.a.createElement("strong",null,t," "),o.a.createElement("small",{className:"text-danger"},"@",n," "),"posted ",o.a.createElement("strong",{className:"dated"},a," "),o.a.createElement(j,{edited:r}),o.a.createElement("span",{className:"text-info"}," ",i," replies")),o.a.createElement("div",{className:"comment-text",name:"comment-text"},o.a.createElement("p",{dangerouslySetInnerHTML:{__html:s}})),o.a.createElement(C,{id:this.props.commentId,ownsNote:this.props.ownsNote,comment:c,editable:this.props.editable,replyUrl:this.props.replyUrl,actionUrl:this.props.actionUrl}))}}]),t}(r.Component),N=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"row text-primary comment",id:"comment"+this.props.commentId},o.a.createElement(b,{user:this.props.user,profile:this.props.imageUrl}),o.a.createElement(k,this.props),o.a.createElement("hr",null))}}]),t}(r.Component),w=new(function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).user={},e.note={},e.comments=[],e.commentsExist=!0,e}return Object(d.a)(t,e),Object(m.a)(t,[{key:"getComments",value:function(){return this.comments}},{key:"getNote",value:function(){return this.note}},{key:"getUser",value:function(){return this.user}},{key:"synthesisComment",value:function(e){return{uuid:e.key,user:e.username,name:e.full_name,imageUrl:e.profile,commentId:e.comment_id,comment:e.text,time:e.time,replies:e.replies,replyUrl:e.reply_url,actionUrl:e.action_url,edited:e.edited,editable:e.editable}}},{key:"fetchComments",value:function(e){var t=this;this.comments=e.comments.map(function(e){return t.synthesisComment(e)}),0===this.comments.length&&(this.commentsExist=!1),this.note={title:e.note,ownerId:e.owner_id,comments:e.comments.length},this.user={id:e.user.id,userName:e.user.username,fullName:e.user.full_name,profileUrl:e.user.profile},this.emit("change")}},{key:"createComment",value:function(e){var t=this.synthesisComment(e);this.comments.unshift(t),this.commentsExist=!0,this.note.comments++,this.emit("change")}},{key:"editComment",value:function(e){var t=this.comments.find(function(t){return t.commentId===e.comment_id});t.edited=!0,t.replies=e.replies,t.comment=e.comment,t.uuid=e.new_key,this.emit("change")}},{key:"deleteComment",value:function(e){var t=this.comments.findIndex(function(t){return t.commentId===+e});this.comments.splice(t,1),this.note.comments--,this.commentsExist=0!==this.note.comments,this.emit("change")}},{key:"handleActions",value:function(e){switch(e.type){case"COMMENTS":this.fetchComments(e.payload);break;case"DELETE_COMMENT":this.deleteComment(e.comment);break;case"COMMENT_EDIT":this.editComment(e.payload);break;case"COMMENT_CREATED":this.createComment(e.payload)}}}]),t}(n(11).EventEmitter));p.register(w.handleActions.bind(w));var T=w;function x(){return o.a.createElement("h2",null,"Loading comments...")}function U(e){return o.a.createElement("div",{id:"no-comments"},o.a.createElement("h3",{className:"alert-heading text-center"},"no comments yet to ",e.noteTitle))}function M(e){return e.noComments?0===e.comments.length?o.a.createElement(x,null):o.a.createElement("div",null,e.comments):o.a.createElement(U,{noteTitle:e.noteTitle})}var _=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).getComments=e.getComments.bind(Object(h.a)(Object(h.a)(e))),e.state={note:T.getNote(),user:T.getUser(),comments:T.getComments(),commentsExist:T.commentsExist},e}return Object(d.a)(t,e),Object(m.a)(t,[{key:"componentWillMount",value:function(){y.a.ajax({type:"GET",url:H,crossDomain:!0,success:function(e){p.dispatch({type:"COMMENTS",payload:e})},error:function(e){}}),T.on("change",this.getComments)}},{key:"componentWillUnmount",value:function(){T.removeListener("change",this.getComments)}},{key:"getComments",value:function(){this.setState({comments:T.getComments(),note:T.getNote(),user:T.getUser(),commentsExist:T.commentsExist})}},{key:"render",value:function(){var e=this.state.note.ownerId===this.state.user.id,t=this.state.comments.map(function(t){return o.a.createElement(N,Object.assign({key:t.uuid},t,{ownsNote:e}))}),n=1===this.state.note.comments?"comment":"comments",a=0===this.state.note.comments?"no comments":"".concat(this.state.note.comments," ").concat(n);return o.a.createElement("div",{id:"comments-section"},o.a.createElement("h3",null,"comments ",o.a.createElement("small",{className:"text-warning"},this.state.note.title," has ",a)),o.a.createElement(E,null),o.a.createElement("hr",null),o.a.createElement(M,{noComments:this.state.commentsExist,comments:t,noteTitle:this.state.note.title}))}}]),t}(r.Component),I=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return o.a.createElement(_,null)}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n.d(t,"noteCommentsApi",function(){return H}),n.d(t,"userSearchUrl",function(){return L}),n.d(t,"token",function(){return S});var D=document.getElementById("comment-zone"),H=D.dataset.commentsUrl,L=D.dataset.searchUserUrl,S=Object(a.a)(document.getElementsByName("csrfmiddlewaretoken")).find(function(e){return"comments"===e.parentElement.id}).value;c.a.render(o.a.createElement(I,null),D),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[13,2,1]]]);
//# sourceMappingURL=main.99d48eee.chunk.js.map